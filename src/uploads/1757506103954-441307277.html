<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Contract Entry</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .form-container {
        max-width: 700px;
        margin: 0 auto;
        margin-top: 40px;
      }
    </style>
  </head>
  <body class="p-4">
    <div class="form-container">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Add Contracts & Procurment Entry</h2>
        <a href="/contracts_external.html" class="btn btn-secondary">Back</a>
      </div>

      <form id="contractForm">
        <div class="mb-3">
          <label for="project_name" class="form-label">Project Name</label>
          <input type="text" class="form-control" id="project_name" required />
        </div>

        <div class="mb-3">
          <label for="capacity" class="form-label">Capacity (MW)</label>
          <input type="text" class="form-control" id="capacity" required />
        </div>

        <div class="mb-3">
          <label for="tender" class="form-label">Tender Type</label>
          <input type="text" class="form-control" id="tender" required />
        </div>

        <div class="mb-3">
          <label for="activity" class="form-label">Tender Status</label>
          <input type="text" class="form-control" id="activity" required />
        </div>

        <div class="mb-3">
          <label for="target_date" class="form-label">Target for Award</label>
          <input type="date" class="form-control" id="target_date" required />
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <script>
      document
        .getElementById("contractForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const data = {
            project_name: document.getElementById("project_name").value.trim(),
            capacity: document.getElementById("capacity").value.trim(),
            tender: document.getElementById("tender").value.trim(),
            activity: document.getElementById("activity").value.trim(),
            target_date: document.getElementById("target_date").value,
          };

          authFetch("/api/data/contracts/add", {
            method: "POST",
            body: JSON.stringify(data),
          })
            .then((res) => {
              if (!res.ok) throw new Error("Failed to add contract.");
              alert("Contract added successfully.");
              window.location.href = "/contracts_external.html";
            })
            .catch((err) => {
              console.error(err);
              alert("Error adding contract.");
            });
        });

      function authFetch(url, options = {}) {
        const token = localStorage.getItem("token");
        const defaultHeaders = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        };

        return fetch(url, {
          ...options,
          headers: {
            ...defaultHeaders,
            ...(options.headers || {}),
          },
        }).then((res) => {
          if (res.status === 401) {
            alert("Session expired. Redirecting to login...");
            localStorage.clear();
            window.location.href = "/";
            throw new Error("Unauthorized");
          }
          return res;
        });
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
